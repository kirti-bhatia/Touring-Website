var cartRecoveryResponse,bookingUrl,mb_bxcheckinUrl,mb_bxretrievepnrUrl;
$(document).ready(function(){768<$(window).width()?(bookingUrl="true"==$("#isProd").val()?"https://booking.qatarairways.com/nsp/views/showBooking.action":"https://nspuat.qatarairways.com.qa/nsp/views/showBooking.action",mb_bxretrievepnrUrl="true"==$("#isProd").val()?"https://booking.qatarairways.com/nsp/views/retrievePnr.xhtml?selLang\x3den":"https://nspuat.qatarairways.com.qa/nsp/views/retrievePnr.xhtml?selLang\x3den",mb_bxcheckinUrl=$("#check-in-manage-desktop-link").val()):768>=$(window).width()&&
(bookingUrl="true"==$("#isProd").val()?"https://m.qatarairways.com/mobile/deeplink/bookingquerystring.htm":"https://nspuat.qatarairways.com.qa/nspMobile/deeplink/bookingquerystring.htm",mb_bxcheckinUrl=$("#check-in-manage-mobile-link").val(),mb_bxretrievepnrUrl="true"==$("#isProd").val()?"https://m.qatarairways.com/mobile/deeplink/managebookingquery.htm":"https://nspuat.qatarairways.com.qa/nsp/views/retrievePnr.xhtml?selLang\x3den");1==$("#cartrecovery").data("cart-enable")&&callBoxever()});
function callBoxever(){var b=null!=(void 0!=getFFPCookieValue("QRTOKEN")||getFFPCookieValue("QRTOKEN"))?"yes":"no";window._boxeverq.push(function(){var c={context:{clientKey:clientKeyVal,browserId:_boxever.getID(),friendlyId:"cartrecovery_homepage*",channel:boxeverChannel,language:boxeverLang,currencyCode:boxeverCurrency,pointOfSale:"qatarairways.com",params:{region:getRegionFromCountry(regionToSend),country:regionToSend,pointOfCommencement:boxeverDefaultOrigin,isloggedin:b}}};try{"qrauthor.qatarairways.com.qa"!=
window.location.hostname&&-1!=currentPageUrl.indexOf("/homepage")&&Boxever.callFlows(c,function(b){handleCartRecoveryFlowResponse(b)},"json")}catch(g){console.log("cart flow erro"+g)}})}
function handleCartRecoveryFlowResponse(b){var c=void 0!=b&&void 0!=b.cartDetails?b.cartDetails:"";if(""!=c&&void 0!=c.deepLink&&""!=c.deepLink){var g=void 0!=c.abandonmentType&&""!=c.abandonmentType,a=c.flightDetails,h="SEARCH"==c.abandonmentType?a.departureDate.split("T")[0]:a.departureDate,n="R"==a.tripType?Granite.I18n.get("returnTrip"):Granite.I18n.get("oneWayTrip"),p=a.origin,q=a.destination;h="R"==a.tripType?getdateFormat(h)+" - "+getdateFormat("SEARCH"==c.abandonmentType?a.returnDate.split("T")[0]:
a.returnDate):getdateFormat(h);var l,m,r,k=null!=a.infants&&void 0!=a.infants&&""!=a.infants?a.infants:0,d=null!=a.children&&void 0!=a.children&&""!=a.children?a.children:0;k=parseInt(null!=a.adults&&void 0!=a.adults&&""!=a.adults?a.adults:0)+parseInt(k)+parseInt(d);var e=getFFPCookieValue("QRTOKEN");d=void 0!=e||null!=e?a.userName:"";d=""!=d?d.charAt(0).toUpperCase()+d.slice(1).toLocaleLowerCase():d;var t=void 0!=e||null!=e?"?pnr\x3d"+a.pnr:"",u=void 0!=e||null!=e?"\x26lastName\x3d"+a.userName:"";
a=$("#cartrecovery").data("cart-heading");var f=$("#cartrecovery").data("cart-subheading"),v=$("#cartrecovery").data("cart-onholdheading");$("#cartrecovery").data("cart-onholdctatext");a="ONHOLD"==g?v:a;mb_bxcheckinUrl=mb_bxcheckinUrl+t+u;e=void 0!=e||null!=e?mb_bxcheckinUrl:mb_bxretrievepnrUrl;$.each(window.cityListJSON,function(a,b){window.cityListJSON[a].shorthand==p&&(l=window.cityListJSON[a].city.split("*")[0].trim());window.cityListJSON[a].shorthand==q&&(m=window.cityListJSON[a].city.split("*")[0].trim(),
r=window.cityListJSON[a].squareImage)});f=0<f.indexOf("{destination}")?f.replace("{destination}",m):f;f=0<f.indexOf("{origin}")?f.replace("{origin}",l):f;a=0<a.indexOf("{destination}")?a.replace("{destination}",m):a;a=0<a.indexOf("{origin}")?a.replace("{origin}",l):a;void 0!=d&&""!=d?(a=void 0!=a&&""!=a?a.charAt(0).toLowerCase()+a.slice(1):"",$(".cartrecovery").find(".section-title").html("\x3cspan\x3e"+d+", \x3c/span\x3e"+a)):(a=void 0!=a&&""!=a?a.charAt(0).toUpperCase()+a.slice(1):"",$(".cartrecovery").find(".section-title").html(a+
"\x3cspan\x3e \x3c/span\x3e"));$(".cartrecovery").find(".section-subtitle").html(f);$(".cartrecovery").find(".imagefullheight img").attr("src",r);$(".cartrecovery").find(".tripdate").text(h);$(".cartrecovery").find(".tripdestinations .tripfrom").text(p);$(".cartrecovery").find(".tripdestinations .tripto").text(q);$(".cartrecovery").find(".tripcountry .tripfrom").text(l);$(".cartrecovery").find(".tripcountry .tripto").text(m);$(".cartrecovery").find(".triptypewithpax").html(n);0!=k&&(n=1<k?Granite.I18n.get("passengers"):
Granite.I18n.get("passenger"),$(".triptypewithpax").append("\x3cbr\x3e \x3cspan\x3e|\x3c/span\x3e "+k+" "+n+"\x3c/div\x3e"));cartRecoveryResponse=b;console.log("response from CART  "+cartRecoveryResponse);b=c.deepLink;b=b.replace(b.substring(0,b.indexOf("?")),bookingUrl);c=void 0!=$("#cartrecovery").data("deeplink-iid")?$("#cartrecovery").data("deeplink-iid"):"";bookingUrl=b+"\x26iid\x3d"+c;bookingUrl="ONHOLD"==g?e:bookingUrl;$(".cartrecovery").removeClass("hide");onCartLoad()}else $(".cartrecovery").remove()}
$(".cartwidget-btn").on("click",function(){var b=$("#current-page-path").val(),c=getPagePathData(b),g=$(this).text().trim().toLowerCase();b=getPageName(b);buttonClickAction(c,g,b+"-cart-recovery");window.open(bookingUrl,"_self");sendBoxeverCartEvent("INTERACTION_CLICKED","CART_WIDGET_HP")});
function sendBoxeverCartEvent(b,c){try{var g=(void 0!=$(document).find("#langpagename").val()?$(document).find("#langpagename").val():"").toLocaleUpperCase(),a={channel:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||-1!=navigator.userAgent.indexOf("Mobile")?"MOBILE_WEB":"WEB",page:bxpageName,language:g,pos:"qatarairways.com",browser_id:Boxever.getID(),type:b,interactionName:c};Boxever.eventCreate(a,function(a){},"json")}catch(h){console.log("Error occured at Cartrecovery widget "+
b)}}function onCartLoad(){sendBoxeverCartEvent("INTERACTION_VIEWED","CART_WIDGET_HP")}function getdateFormat(b){b=(new Date(b)).toUTCString().split(" ");return b[1]+" "+b[2]+" "+b[3]};